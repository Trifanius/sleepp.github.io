<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–∫–µ—Ä —Å–Ω–∞</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#121212"/>
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∑–¥–µ—Å—å, –∫–∞–∫ –∏ –≤ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏ */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 400px; background-color: #1e1e1e; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); margin-bottom: 20px; }
        h1, h2 { text-align: center; color: #bb86fc; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .btn { display: block; width: 100%; padding: 15px; font-size: 18px; font-weight: bold; color: #121212; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s, transform 0.1s; }
        #startBtn { background-color: #03dac6; }
        #endBtn { background-color: #bb86fc; display: none; }
        .btn:active { transform: scale(0.98); }
        #status { text-align: center; font-size: 16px; margin-top: 15px; color: #aaa; height: 20px; }
        .sleep-type-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .sleep-type-selector input[type="radio"] { display: none; }
        .sleep-type-selector label { padding: 10px 20px; border: 2px solid #333; border-radius: 20px; cursor: pointer; transition: background-color 0.3s, border-color 0.3s; }
        .sleep-type-selector input[type="radio"]:checked + label { background-color: #bb86fc; border-color: #bb86fc; color: #121212; font-weight: bold; }
        .reminder-container { margin-top: 20px; text-align: center; }
        .reminder-container input[type="time"] { background-color: #2c2c2c; color: #e0e0e0; border: 1px solid #444; border-radius: 8px; padding: 8px; font-size: 16px; }
        #reminderStatus { margin-top: 10px; font-size: 16px; color: #fdd835; font-weight: bold; height: 20px; }
        #ratingSection { display: none; margin-top: 20px; }
        .rating-label { display: block; text-align: center; margin-bottom: 10px; }
        .stars { display: flex; justify-content: center; gap: 10px; }
        .star { font-size: 30px; cursor: pointer; color: #444; transition: color 0.2s; }
        .star:hover, .star.selected { color: #fdd835; }
        textarea { width: 100%; box-sizing: border-box; margin-top: 10px; padding: 10px; border-radius: 8px; border: 1px solid #444; background-color: #2c2c2c; color: #e0e0e0; font-size: 16px; resize: vertical; }
        #saveBtn { margin-top: 15px; background-color: #03dac6; }
        #historyList { list-style: none; padding: 0; }
        .history-item { background-color: #2c2c2c; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .history-item p { margin: 5px 0; }
        .history-item strong { color: #03dac6; }
        .history-item.night { border-left: 5px solid #bb86fc; }
        .history-item.day { border-left: 5px solid #fdd835; }
    </style>
</head>
<body>
    <div class="container">
        <h1>–¢—Ä–µ–∫–µ—Ä —Å–Ω–∞ üåô</h1>
        <div class="sleep-type-selector">
            <input type="radio" id="nightSleep" name="sleepType" value="night" checked><label for="nightSleep">üåÉ –ù–æ—á–Ω–æ–π</label>
            <input type="radio" id="daySleep" name="sleepType" value="day"><label for="daySleep">‚òÄÔ∏è –î–Ω–µ–≤–Ω–æ–π</label>
        </div>
        <button id="startBtn" class="btn">–ù–∞—á–∞—Ç—å —Å–æ–Ω</button>
        <button id="endBtn" class="btn">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–Ω</button>
        <p id="status"></p>
        <div id="ratingSection">
            <label class="rating-label">–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞:</label>
            <div class="stars" data-rating="0">
                <span class="star" data-value="1">‚òÖ</span><span class="star" data-value="2">‚òÖ</span><span class="star" data-value="3">‚òÖ</span><span class="star" data-value="4">‚òÖ</span><span class="star" data-value="5">‚òÖ</span>
            </div>
            <textarea id="notes" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∑–∞–º–µ—Ç–∫—É..."></textarea>
            <button id="saveBtn" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
        </div>
    </div>
    <div class="container reminder-container">
        <h2>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Å–Ω–µ</h2>
        <label for="bedtime">–ñ–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è –æ—Ç—Ö–æ–¥–∞ –∫–æ —Å–Ω—É:</label><br><br>
        <input type="time" id="bedtime">
        <p id="reminderStatus"></p>
    </div>
    <div class="container">
        <h2>–ò—Å—Ç–æ—Ä–∏—è —Å–Ω–æ–≤</h2>
        <ul id="historyList"></ul>
    </div>

    <script>
        // –í–µ—Å—å JavaScript-–∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –∑–¥–µ—Å—å, –∫–∞–∫ –≤ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏
        const startBtn=document.getElementById("startBtn"),endBtn=document.getElementById("endBtn"),saveBtn=document.getElementById("saveBtn"),statusEl=document.getElementById("status"),ratingSection=document.getElementById("ratingSection"),starsContainer=document.querySelector(".stars"),stars=document.querySelectorAll(".star"),notesEl=document.getElementById("notes"),historyList=document.getElementById("historyList"),bedtimeInput=document.getElementById("bedtime"),reminderStatus=document.getElementById("reminderStatus");let sleepStartTime=null,sleepType="night";function updateUIForSleep(){startBtn.style.display="none",endBtn.style.display="block",document.querySelector(".sleep-type-selector").style.display="none",statusEl.textContent=`–°–æ–Ω (${"night"===sleepType?"–Ω–æ—á–Ω–æ–π":"–¥–Ω–µ–≤–Ω–æ–π"}) –Ω–∞—á–∞–ª—Å—è –≤ ${formatTime(sleepStartTime)}.`}function resetUI(){startBtn.style.display="block",endBtn.style.display="none",ratingSection.style.display="none",document.querySelector(".sleep-type-selector").style.display="flex",statusEl.textContent="",notesEl.value="",starsContainer.dataset.rating="0",stars.forEach(e=>{e.classList.remove("selected")}),localStorage.removeItem("sleepStartTime"),localStorage.removeItem("sleepType"),sleepStartTime=null}function calculateDuration(e,t){const o=t-e,n=Math.floor(o/36e5);return{hours:n,minutes:Math.floor(o%36e5/6e4)}}function formatTime(e){return e.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}function saveRecord(e){const t=getHistory();t.push(e),localStorage.setItem("sleepHistory",JSON.stringify(t))}function getHistory(){return JSON.parse(localStorage.getItem("sleepHistory"))||[]}function addRecordToDOM(e){const t=document.createElement("li");t.className=`history-item ${e.type}`;const o=new Date(e.start),n=new Date(e.end),s="night"===e.type?"üåÉ":"‚òÄÔ∏è";t.innerHTML=`\n                <p><strong>–î–∞—Ç–∞:</strong> ${o.toLocaleDateString("ru-RU")} ${s}</p>\n                <p><strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${e.duration.hours} —á ${e.duration.minutes} –º–∏–Ω</p>\n                <p><strong>–í—Ä–µ–º—è:</strong> ${formatTime(o)} - ${formatTime(n)}</p>\n                <p><strong>–û—Ü–µ–Ω–∫–∞:</strong> ${"‚òÖ".repeat(e.rating)}${"‚òÜ".repeat(5-e.rating)}</p>\n                ${e.notes?`<p><strong>–ó–∞–º–µ—Ç–∫–∞:</strong> ${e.notes}</p>`:""}\n            `,historyList.prepend(t)}function loadHistory(){getHistory().forEach(e=>{addRecordToDOM(e)})}function checkBedtime(){const e=localStorage.getItem("bedtime");if(!e)return;const t=(new Date).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});reminderStatus.textContent=t===e?"–ü–æ—Ä–∞ —Å–ø–∞—Ç—å!":""}function checkInitialState(){const e=localStorage.getItem("sleepStartTime");if(e)sleepStartTime=new Date(e),sleepType=localStorage.getItem("sleepType")||"night",updateUIForSleep();const t=localStorage.getItem("bedtime");t&&(bedtimeInput.value=t),loadHistory(),setInterval(checkBedtime,1e3)}startBtn.addEventListener("click",()=>{sleepStartTime=new Date,sleepType=document.querySelector('input[name="sleepType"]:checked').value,localStorage.setItem("sleepStartTime",sleepStartTime.toISOString()),localStorage.setItem("sleepType",sleepType),updateUIForSleep()}),endBtn.addEventListener("click",()=>{ratingSection.style.display="block",endBtn.style.display="none",statusEl.textContent="–û—Ü–µ–Ω–∏—Ç–µ —Å–≤–æ–π —Å–æ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∑–∞–ø–∏—Å—å."}),stars.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.value;starsContainer.dataset.rating=t,stars.forEach(e=>{e.classList.toggle("selected",e.dataset.value<=t)})})}),saveBtn.addEventListener("click",()=>{const e=new Date,t=starsContainer.dataset.rating,o=notesEl.value;if("0"===t)return void alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞.");const n={id:Date.now(),start:sleepStartTime.toISOString(),end:e.toISOString(),duration:calculateDuration(sleepStartTime,e),rating:parseInt(t),notes:o,type:sleepType};saveRecord(n),addRecordToDOM(n),resetUI()}),bedtimeInput.addEventListener("change",e=>{localStorage.setItem("bedtime",e.target.value),alert(`–í—Ä–µ–º—è –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ ${e.target.value}`)}),checkInitialState();
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful');
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>